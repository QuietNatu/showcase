<!-- TODO: check a11y -->

@if (isExpanded()) {
  <ng-container
    natuAccordion
    [natuAccordionIsExpanded]="isGroupPresent()"
    (natuAccordionIsExpandedChange)="handleGroupExpandedChange($event)"
  >
    <button
      type="button"
      class="sidebar__item"
      natuAccordionTrigger
      natuFocusRing
      [natuFocusRingFocusVisibleClass]="'sidebar__item--focus'"
    >
      <ng-template [ngTemplateOutlet]="iconContainerTemplate" />
      <ng-template [ngTemplateOutlet]="labelContainerTemplate" />

      <span class="sidebar__item-group-icon-area">
        <svg-icon class="sidebar__item-group-icon" [key]="'caret-down'" />
      </span>
    </button>

    <div #groupList class="sidebar__group-list" (transitionend)="handleGroupTransitionEnd()">
      <ul natuAccordionContent class="sidebar__list">
        @for (item of items(); track $index) {
          <li class="sidebar__list-item">
            <ng-template [ngTemplateOutlet]="item" />
          </li>
        }
      </ul>
    </div>
  </ng-container>
} @else if (isGroupPopoverOpen()) {
  <button
    type="button"
    class="sidebar__item"
    natuFocusRing
    [natuFocusRingFocusVisibleClass]="'sidebar__item--focus'"
    natuPopover
    [natuPopoverTitle]="labelTemplate()"
    [natuPopoverContent]="popoverGroupList"
    [natuPopoverPlacement]="'right'"
    [natuPopoverIsOpen]="isGroupPopoverOpen()"
    (natuPopoverIsOpenChange)="isGroupPopoverOpen.set(false)"
  >
    <ng-template [ngTemplateOutlet]="iconContainerTemplate" />
    <ng-template [ngTemplateOutlet]="labelContainerTemplate" />
  </button>
} @else {
  <button
    type="button"
    class="sidebar__item"
    natuFocusRing
    [natuFocusRingFocusVisibleClass]="'sidebar__item--focus'"
    [natuTooltip]="labelTemplate()"
    [natuTooltipPlacement]="'right'"
    (click)="isGroupPopoverOpen.set(true)"
  >
    <ng-template [ngTemplateOutlet]="iconContainerTemplate" />
    <ng-template [ngTemplateOutlet]="labelContainerTemplate" />
  </button>
}

<ng-template #iconContainerTemplate>
  @if (iconTemplate(); as iconTemplate) {
    <span class="sidebar__item-icon">
      <ng-template [ngTemplateOutlet]="iconTemplate" />
    </span>
  }
</ng-template>

<ng-template #labelContainerTemplate>
  @if (labelTemplate(); as labelTemplate) {
    <span class="sidebar__item-label">
      <ng-template [ngTemplateOutlet]="labelTemplate" />
    </span>
  }
</ng-template>

<!-- TODO: put items in expanded mode -->
<ng-template #popoverGroupList>
  <div class="sidebar__group-list">
    <ul class="sidebar__list">
      @for (item of items(); track $index) {
        <li class="sidebar__list-item">
          <ng-template [ngTemplateOutlet]="item" />
        </li>
      }
    </ul>
  </div>
</ng-template>
